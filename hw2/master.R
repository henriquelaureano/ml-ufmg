## ----setup, include=FALSE------------------------------------------------
library(knitr)

tema <- knit_theme$get("acid")

knit_theme$set(tema)

opts_chunk$set(size = 'small'
               , cache = TRUE
               , cache.path = 'cache/'
               , comment = NA
               , warning = FALSE
               , message = FALSE
               , fig.align = 'center'
               , fig.width = 8
               , fig.height = 4.5
               , dpi = 100
               , fig.path = 'iBagens/'
               , fig.pos = 'H'
               , background = '#ffffff'
               , results = 'hold'
               , fig.show = 'hold')

## ------------------------------------------------------------------------
# <code r> ================================================================== #
path <- "C:/Users/henri/Dropbox/Scripts/aprendizado de maquina/list 2/"

data <- read.table(paste0(path, "titanic.txt"))

summary(data)
# </code r> ================================================================= #

## ------------------------------------------------------------------------
# <code r> ================================================================== #
test.psg <- sample(size = nrow(data) * .2, x = 0:nrow(data))

train <- data[-test.psg, ] # nrow(train): 1761

test <- data[test.psg, ] # nrow(test): 440
# </code r> ================================================================= #

## ------------------------------------------------------------------------
# <code r> ================================================================== #
reg.log <- glm(Survived ~ ., train, family = binomial)
# </code r> ================================================================= #

## ------------------------------------------------------------------------
# <code r> ================================================================== #
anova(reg.log, test = "Chisq")
# </code r> ================================================================= #

## ------------------------------------------------------------------------
# <code r> ================================================================== #
car::Anova(reg.log)
# </code r> ================================================================= #

## ------------------------------------------------------------------------
# <code r> ================================================================== #
cbind(Estimates = coef(reg.log), confint.default(reg.log))
# </code r> ================================================================= #

## ------------------------------------------------------------------------
# <code r> ================================================================== #
exp(cbind(OR = coef(reg.log), confint.default(reg.log)))
# </code r> ================================================================= #

## ------------------------------------------------------------------------
# <code r> ================================================================== #
reg.lin <- lm(as.numeric(Survived) ~ ., train)
# </code r> ================================================================= #

## ------------------------------------------------------------------------
# <code r> ================================================================== #
anova(reg.lin)
# </code r> ================================================================= #

## ------------------------------------------------------------------------
# <code r> ================================================================== #
car::Anova(reg.lin)
# </code r> ================================================================= #

## ------------------------------------------------------------------------
# <code r> ================================================================== #
cbind(Estimates = coef(reg.lin), confint(reg.lin))
# </code r> ================================================================= #

## ------------------------------------------------------------------------
# <code r> ================================================================== #
library(e1071)

nb <- naiveBayes(Survived ~ ., train)

nb$tables
# </code r> ================================================================= #

## ------------------------------------------------------------------------
# <code r> ================================================================== #
library(MASS)

dl <- lda(Survived ~ ., train)

dl$scaling
# </code r> ================================================================= #

## ------------------------------------------------------------------------
# <code r> ================================================================== #
dq <- qda(Survived ~ ., train)

dq$scaling
# </code r> ================================================================= #

## ----fig.height=3.5------------------------------------------------------
# <code r> ================================================================== #
library(FNN)

train.knn <- train
train.knn$Class <- as.numeric(train.knn$Class)
train.knn$Sex <- as.numeric(train.knn$Sex)
train.knn$Age <- as.numeric(train.knn$Age)
train.knn$Survived <- as.numeric(train.knn$Survived)

test.knn <- test
test.knn$Class <- as.numeric(test.knn$Class)
test.knn$Sex <- as.numeric(test.knn$Sex)
test.knn$Age <- as.numeric(test.knn$Age)

risco <- 0
for (i in 1:nrow(test.knn)){
  knn <- knn.reg(train.knn[ , -4], test.knn[ , -4], train.knn[ , 4], k = i)
  risco[i] <- mean(test.knn$Survived != ifelse(knn$pred < 1.5, "No", "Yes"))}

library(latticeExtra)
xyplot(risco ~ 1:nrow(test.knn)
       , type = c("l", "g")
       , xlab = "k"
       , ylab = "Risco"
       , lwd = 2
       , panel= function(...){
         panel.xyplot(...)
         panel.abline(v = which.min(risco), col = 2, lwd = 2)
         panel.text(30, .295, labels = paste("k =", which.min(risco)), col = 2)
         })
# </code r> ================================================================= #

## ------------------------------------------------------------------------
# <code r> ================================================================== #
mean(
  test$Survived != ifelse(predict(reg.log, test, type = "response") < .5
                          , "No", "Yes"))
# </code r> ================================================================= #

## ------------------------------------------------------------------------
# <code r> ================================================================== #
mean(test$Survived != ifelse(predict(reg.lin, test) < 1.5, "No", "Yes"))
# </code r> ================================================================= #

## ------------------------------------------------------------------------
# <code r> ================================================================== #
mean(test$Survived != predict(nb, test))
# </code r> ================================================================= #

## ------------------------------------------------------------------------
# <code r> ================================================================== #
mean(test$Survived != predict(dl, test)$class)
# </code r> ================================================================= #

## ------------------------------------------------------------------------
# <code r> ================================================================== #
mean(test$Survived != predict(dq, test)$class)
# </code r> ================================================================= #

## ------------------------------------------------------------------------
# <code r> ================================================================== #
knn <- knn.reg(
  train.knn[ , -4], test.knn[ , -4], train.knn[ , 4], k = which.min(risco))

mean(test.knn$Survived != ifelse(knn$pred < 1.5, "No", "Yes"))
# </code r> ================================================================= #

## ----results='hide', fig.width=10, fig.height=14-------------------------
# <code r> ================================================================== #
library(pROC)

par(mfrow = c(3, 2))

plot.roc(
  roc(test$Survived, predict(reg.log, test, type = "response"))
  , print.auc = TRUE
  , print.thres = TRUE
  , las = 1
  , xlab = "Especificidade"
  , ylab = "Sensibilidade"
  , main = "Regressão Logística")

plot.roc(
  roc(test$Survived, predict(reg.lin, test))
  , print.auc = TRUE
  , print.thres = TRUE
  , las = 1
  , xlab = "Especificidade"
  , ylab = "Sensibilidade"
  , main = "Regressão Linear")

plot.roc(
  roc(test$Survived, as.numeric(predict(nb, test)))
  , print.auc = TRUE
  , print.thres = TRUE
  , las = 1
  , xlab = "Especificidade"
  , ylab = "Sensibilidade"
  , main = "Naive Bayes")

plot.roc(
  roc(test$Survived, as.numeric(predict(dl, test)$class))
  , print.auc = TRUE
  , print.thres = TRUE
  , las = 1
  , xlab = "Especificidade"
  , ylab = "Sensibilidade"
  , main = "Discriminante Linear")

plot.roc(
  roc(test$Survived, as.numeric(predict(dq, test)$class))
  , print.auc = TRUE
  , print.thres = TRUE
  , las = 1
  , xlab = "Especificidade"
  , ylab = "Sensibilidade"
  , main = "Discriminante Quadrática")

plot.roc(
  roc(test$Survived, knn$pred)
  , print.auc = TRUE
  , print.thres = TRUE
  , las = 1
  , xlab = "Especificidade"
  , ylab = "Sensibilidade"
  , main = "KNN")
# </code r> ================================================================= #

## ------------------------------------------------------------------------
# <code r> ================================================================== #
table(test$Survived, ifelse(predict(reg.log, test, type = "response") < .5
                            , "No", "Yes")
      , dnn = list("Observado", "Predito"))
# </code r> ================================================================= #

## ------------------------------------------------------------------------
# <code r> ================================================================== #
table(test$Survived, ifelse(predict(reg.log, test, type = "response") < .299
                            , "No", "Yes")
      , dnn = list("Observado", "Predito"))
# </code r> ================================================================= #

## ------------------------------------------------------------------------
# <code r> ================================================================== #
table(test$Survived, ifelse(predict(reg.lin, test) < 1.5, "No", "Yes")
      , dnn = list("Observado", "Predito"))
# </code r> ================================================================= #

## ------------------------------------------------------------------------
# <code r> ================================================================== #
table(test$Survived, ifelse(predict(reg.lin, test) < 1.309, "No", "Yes")
      , dnn = list("Observado", "Predito"))
# </code r> ================================================================= #

## ------------------------------------------------------------------------
# <code r> ================================================================== #
table(test$Survived, predict(nb, test), dnn = list("Observado", "Predito"))
# </code r> ================================================================= #

## ------------------------------------------------------------------------
# <code r> ================================================================== #
table(test$Survived, predict(dl, test)$class
      , dnn = list("Observado", "Predito"))
# </code r> ================================================================= #

## ------------------------------------------------------------------------
# <code r> ================================================================== #
table(test$Survived, predict(dq, test)$class
      , dnn = list("Observado", "Predito"))
# </code r> ================================================================= #

## ------------------------------------------------------------------------
# <code r> ================================================================== #
table(test$Survived, ifelse(knn$pred < 1.5, "No", "Yes")
      , dnn = list("Observado", "Predito"))
# </code r> ================================================================= #

## ------------------------------------------------------------------------
# <code r> ================================================================== #
table(test$Survived, ifelse(knn$pred < 1.25, "No", "Yes")
      , dnn = list("Observado", "Predito"))
# </code r> ================================================================= #

